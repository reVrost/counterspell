package components

import (
	"fmt"
	"github.com/revrost/code/counterspell/internal/models"
)

templ SettingsModal(settings models.UserSettings) {
	<div x-show="settingsOpen" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4" x-cloak
		x-transition.opacity>
		<div @click.outside="settingsOpen = false" 
			class="bg-[#16191F] border border-gray-700 w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto">
			
			<div class="px-6 py-4 border-b border-gray-800 flex justify-between items-center sticky top-0 bg-[#16191F] z-10">
				<h2 class="text-lg font-bold text-white">Settings</h2>
				<button @click="settingsOpen = false" class="text-gray-500 hover:text-white transition"><i class="fas fa-times"></i></button>
			</div>

			<form hx-post="/settings" hx-swap="none" class="p-6 space-y-8" x-data={ fmt.Sprintf("{ agentBackend: '%s' }", settings.GetAgentBackend()) }>
				<!-- Agent Backend -->
				<div>
					<h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
						<i class="fas fa-robot"></i> Agent Backend
					</h3>
					<div class="grid grid-cols-2 gap-3">
						<label @click="agentBackend = 'native'"
							:class="agentBackend === 'native' ? 'border-purple-500 bg-purple-500/10' : 'border-gray-700 bg-gray-900 hover:border-gray-600'"
							class="relative flex items-center p-3 rounded-lg border cursor-pointer transition-all">
							<input type="radio" name="agent_backend" value="native" 
								x-model="agentBackend"
								class="sr-only"/>
							<div class="flex flex-col">
								<span class="text-sm font-medium text-white">Counterspell</span>
								<span class="text-xs text-gray-500">Native Go agent</span>
							</div>
							<div :class="agentBackend === 'native' ? 'border-purple-500' : 'border-gray-600'"
								class="absolute top-2 right-2 w-4 h-4 rounded-full border-2 flex items-center justify-center">
								<div x-show="agentBackend === 'native'" class="w-2 h-2 rounded-full bg-purple-500"></div>
							</div>
						</label>
						<label @click="agentBackend = 'claude-code'"
							:class="agentBackend === 'claude-code' ? 'border-purple-500 bg-purple-500/10' : 'border-gray-700 bg-gray-900 hover:border-gray-600'"
							class="relative flex items-center p-3 rounded-lg border cursor-pointer transition-all">
							<input type="radio" name="agent_backend" value="claude-code"
								x-model="agentBackend"
								class="sr-only"/>
							<div class="flex flex-col">
								<span class="text-sm font-medium text-white">Claude Code</span>
								<span class="text-xs text-gray-500">Anthropic CLI</span>
							</div>
							<div :class="agentBackend === 'claude-code' ? 'border-purple-500' : 'border-gray-600'"
								class="absolute top-2 right-2 w-4 h-4 rounded-full border-2 flex items-center justify-center">
								<div x-show="agentBackend === 'claude-code'" class="w-2 h-2 rounded-full bg-purple-500"></div>
							</div>
						</label>
					</div>
					<p class="text-xs text-gray-600 mt-2">
						<i class="fas fa-info-circle mr-1"></i>
						Counterspell uses your API keys. Claude Code requires the <code class="text-purple-400">claude</code> CLI installed.
					</p>
				</div>

				<!-- API Keys -->
				<div>
					<h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
						<i class="fas fa-key"></i> BYOK (Bring Your Own Keys)
					</h3>
					<div class="space-y-4">
						<div>
							<label class="block text-xs font-medium text-gray-400 mb-1.5">OpenRouter API Key</label>
							<div class="relative">
								<input type="password" name="openrouter_key" value={ settings.OpenRouterKey }
										class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:outline-none font-mono placeholder-gray-700" 
										placeholder="sk-or-...">
							</div>
						</div>
						<div>
							<label class="block text-xs font-medium text-gray-400 mb-1.5">Z.ai API Key</label>
							<input type="password" name="zai_key" value={ settings.ZaiKey }
									class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:outline-none font-mono placeholder-gray-700" 
									placeholder="zai-...">
						</div>
						<div>
							<label class="block text-xs font-medium text-gray-400 mb-1.5">Anthropic API Key</label>
							<input type="password" name="anthropic_key" value={ settings.AnthropicKey }
									class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:outline-none font-mono placeholder-gray-700" 
									placeholder="sk-ant-...">
						</div>
						<div>
							<label class="block text-xs font-medium text-gray-400 mb-1.5">OpenAI API Key</label>
							<input type="password" name="openai_key" value={ settings.OpenAIKey }
									class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:border-purple-500 focus:outline-none font-mono placeholder-gray-700" 
									placeholder="sk-...">
						</div>
					</div>
				</div>

				<!-- Save Button -->
				<div class="flex justify-end">
					<button type="submit" class="bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold px-4 py-2 rounded-lg transition-colors">
						Save Changes
					</button>
				</div>

				<!-- Sponsor -->
				<div class="bg-gradient-to-br from-purple-900/20 to-blue-900/20 border border-purple-500/30 rounded-xl p-5 text-center mt-8">
					<div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-3 border border-gray-700 shadow-xl">
						<i class="fas fa-heart text-pink-500 animate-pulse"></i>
					</div>
					<h3 class="text-sm font-bold text-white mb-1">Support Open Source</h3>
					<p class="text-xs text-gray-400 mb-4 leading-relaxed">Conductor is free and open source. Your sponsorship helps keep the lights on and the agents coding.</p>
					<button type="button" class="bg-white text-black text-xs font-bold px-4 py-2 rounded-lg hover:bg-gray-200 transition active:scale-95">
						<i class="fas fa-gift mr-1"></i> Sponsor Project
					</button>
				</div>
				
				<div class="text-center">
					<p class="text-[10px] text-gray-600 font-mono">Counterspell v2.1 (Build 8492)</p>
				</div>
			</form>
		</div>
	</div>
}
